FROM node:18.9.0-slim

RUN mkdir -p /usr/src/app

WORKDIR /usr/src/app


COPY package.json /usr/src/app

RUN npm install

COPY . /usr/src/app
#Add environmental variables
ARG SERVER
ARG DB
ARG PASSWORD
ARG USERNAME
ARG AUTH_JWT_SECRET
ARG RABBIT_MQ_URL
ARG BILLING_WORKER_MS
ARG CUSTOMER_MS

ENV SERVER $SERVER
ENV DB $DB
ENV PASSWORD $PASSWORD
ENV USERNAME $USERNAME
ENV AUTH_JWT_SECRET $AUTH_JWT_SECRET
ENV RABBIT_MQ_URL $RABBIT_MQ_URL
ENV BILLING_WORKER_MS $BILLING_WORKER_MS
ENV CUSTOMER_MS $CUSTOMER_MS

EXPOSE 3000

CMD [ "npm", "start" ]